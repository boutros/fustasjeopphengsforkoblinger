import dbmixin from '../dbmixin.js'
import { NamedNode, Triple, Variable } from '../rdf.js'
import state from '../state.js'

<input-literal>
	<input type="text" name="literal">

	<style scoped>
		input { width: 100% }
	</style>

	<script>
		let tag = this
		tag.previousValue = undefined

		if (!tag.opts.predicate) {
			throw new Error("input-literal must have a opts.predicate")
		}

		let pattern = new Triple(
			new NamedNode(state.centerNode),
			new NamedNode(state.ns + tag.opts.predicate),
			new Variable(""))

		tag.mixin(dbmixin(pattern))

		tag.dbEvents.on('dbupdate', function(tx) {
			if (tx.inserted) {
				// TODO patch /services
				tag.literal.value = tx.inserted.o.value()
				tag.previousValue = tag.literal.value
			} else if (tx.deleted) {
				// TODO patch /services
				tag.literal.value = ""
				tag.previousValue = undefined
			}
		})

	</script>
</input-literal>